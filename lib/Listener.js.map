{"version":3,"sources":["../src/Listener.js"],"names":[],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;AAEA,IAAM,mBAAmB,KAAzB;;IAEqB,Q;AACnB,sBAA0B;AAAA,QAAd,OAAc,yDAAJ,EAAI;AAAA;;AACxB,SAAK,GAAL,GAAW,QAAQ,GAAnB;AACA,SAAK,QAAL,GAAgB,QAAQ,QAAR,IAAoB,gBAApC;AACA,SAAK,MAAL,GAAc,uBAAa,QAAQ,IAArB,EAA2B,QAAQ,IAAnC,CAAd;AACA,SAAK,OAAL,GAAe,uBAAf;AACD;;qBAED,M,qBAAS;AAAA;;AACP,SAAK,GAAL,CAAS,EAAT,CAAY,aAAZ,EAA2B,gBAAoC;AAAA,UAAzB,OAAyB,QAAjC,GAAiC,CAAzB,OAAyB;AAAA,UAAd,OAAc,QAAd,OAAc;;AAC7D,UAAI,OAAJ,EAAa;AACX,cAAK,OAAL,CAAa,IAAb,CAAkB,QAAQ,KAA1B,EAAiC,OAAjC;AACD;AACF,KAJD;;AAMA,gBAAY,YAAM;AAChB,YAAK,MAAL,CAAY,KAAZ,CAAkB,MAAK,OAAL,CAAa,OAAb,EAAlB,EACG,IADH,CACQ;AAAA,eAAM,MAAK,OAAL,CAAa,KAAb,EAAN;AAAA,OADR,EAEG,KAFH,CAES;AAAA,eAAS,QAAQ,KAAR,CAAc,MAAM,KAApB,CAAT;AAAA,OAFT;AAGD,KAJD,EAIG,KAAK,QAJR;;AAMA,WAAO,IAAP;AACD,G;;;;;kBAtBkB,Q","file":"Listener.js","sourcesContent":["import Graphite from './Graphite';\nimport Metrics from './Metrics';\n\nconst DEFAULT_INTERVAL = 10000;\n\nexport default class Listener {\n  constructor(options = {}) {\n    this.bus = options.bus;\n    this.interval = options.interval || DEFAULT_INTERVAL;\n    this.sender = new Graphite(options.host, options.port);\n    this.metrics = new Metrics();\n  }\n\n  listen() {\n    this.bus.on('process:msg', ({ raw : { metrics }, process }) => {\n      if (metrics) {\n        this.metrics.push(process.pm_id, metrics);\n      }\n    });\n\n    setInterval(() => {\n      this.sender.write(this.metrics.flatten())\n        .then(() => this.metrics.empty())\n        .catch(error => console.error(error.stack));\n    }, this.interval);\n\n    return this;\n  }\n}\n"]}