{"version":3,"sources":["../src/PM2Monyt.js"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AACA;;;;;;IAEqB,Q;AACnB,sBAA0B;AAAA,QAAd,OAAc,yDAAJ,EAAI;AAAA;;AACxB,SAAK,QAAL,GAAgB,QAAQ,QAAR,IAAoB,EAApC;AACA,SAAK,MAAL,GAAc,qDAAwB,OAAxB,EAAd;AACA,SAAK,GAAL,GAAW,QAAQ,GAAnB;AACA,SAAK,OAAL,GAAe,yBAAe,EAAE,MAAM,KAAK,QAAL,CAAc,MAAtB,EAAf,CAAf;AACD;;qBAED,M,qBAAS;AAAA;;AACP,SAAK,GAAL,CAAS,EAAT,CAAY,aAAZ,EAA2B,gBAA4C;AAAA,0BAAzC,GAAyC;AAAA,UAAjC,MAAiC,YAAjC,MAAiC;AAAA,UAAzB,OAAyB,YAAzB,OAAyB;AAAA,UAAd,OAAc,QAAd,OAAc;;AACrE,UAAI,MAAJ,EAAY;AACV,cAAK,MAAL,GAAc,qDAAwB,MAAxB,EAAd;AACD;AACD,UAAI,OAAJ,EAAa;AACX,cAAK,OAAL,CAAa,IAAb,CAAkB,QAAQ,KAA1B,EAAiC,OAAjC;AACA,YAAI,MAAK,OAAL,CAAa,MAAb,EAAJ,EAA2B;AACzB,gBAAK,MAAL,CAAY,IAAZ,CAAiB,MAAK,OAAL,CAAa,OAAb,EAAjB,EACG,IADH,CACQ;AAAA,mBAAM,MAAK,OAAL,CAAa,KAAb,EAAN;AAAA,WADR,EAEG,KAFH,CAES;AAAA,mBAAS,QAAQ,KAAR,CAAc,MAAM,KAApB,CAAT;AAAA,WAFT;AAGD;AACF;AACF,KAZD;AAaA,WAAO,IAAP;AACD,G;;;;;kBAvBkB,Q","file":"PM2Monyt.js","sourcesContent":["import { GraphiteSender } from 'monyt';\nimport PM2Metrics from './PM2Metrics';\n\nexport default class PM2Monyt {\n  constructor(options = {}) {\n    this.clusters = options.clusters || [];\n    this.sender = new GraphiteSender({ ...options });\n    this.bus = options.bus;\n    this.metrics = new PM2Metrics({ size: this.clusters.length });\n  }\n\n  listen() {\n    this.bus.on('process:msg', ({ raw : { client, metrics }, process }) => {\n      if (client) {\n        this.sender = new GraphiteSender({ ...client });\n      }\n      if (metrics) {\n        this.metrics.push(process.pm_id, metrics);\n        if (this.metrics.isFull()) {\n          this.sender.send(this.metrics.flatten())\n            .then(() => this.metrics.empty())\n            .catch(error => console.error(error.stack));\n        }\n      }\n    });\n    return this;\n  }\n}\n"]}