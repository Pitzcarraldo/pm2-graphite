{"version":3,"sources":["../src/PM2Monyt.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;IAGqB;AACnB,WADmB,QACnB,GAA0B;QAAd,gEAAU,kBAAI;wCADP,UACO;;AACxB,SAAK,QAAL,GAAgB,QAAQ,QAAR,IAAoB,EAApB,CADQ;AAExB,SAAK,MAAL,GAAc,qDAAwB,QAAxB,CAAd,CAFwB;AAGxB,SAAK,GAAL,GAAW,QAAQ,GAAR,CAHa;AAIxB,SAAK,OAAL,GAAe,yBAAe,EAAE,MAAM,KAAK,QAAL,CAAc,MAAd,EAAvB,CAAf,CAJwB;GAA1B;;AADmB,qBAQnB,2BAAS;;;AACP,SAAK,GAAL,CAAS,EAAT,CAAY,aAAZ,EAA2B,gBAA4C;0BAAzC,IAAyC;UAAjC,yBAAiC;UAAzB,2BAAyB;UAAd,uBAAc;;AACrE,UAAI,MAAJ,EAAY;AACV,cAAK,MAAL,GAAc,qDAAwB,OAAxB,CAAd,CADU;OAAZ;AAGA,UAAI,OAAJ,EAAa;AACX,cAAK,OAAL,CAAa,IAAb,CAAkB,QAAQ,KAAR,EAAe,OAAjC,EADW;AAEX,YAAI,MAAK,OAAL,CAAa,MAAb,EAAJ,EAA2B;AACzB,gBAAK,MAAL,CAAY,IAAZ,CAAiB,MAAK,OAAL,CAAa,OAAb,EAAjB,EACG,IADH,CACQ;mBAAM,MAAK,OAAL,CAAa,KAAb;WAAN,CADR,CAEG,KAFH,CAES;mBAAS,QAAQ,KAAR,CAAc,MAAM,KAAN;WAAvB,CAFT,CADyB;SAA3B;OAFF;KAJyB,CAA3B,CADO;AAcP,WAAO,IAAP,CAdO;;;SARU","file":"PM2Monyt.js","sourcesContent":["import { GraphiteSender } from 'monyt';\nimport PM2Metrics from './PM2Metrics';\n\nexport default class PM2Monyt {\n  constructor(options = {}) {\n    this.clusters = options.clusters || [];\n    this.sender = new GraphiteSender({ ...options });\n    this.bus = options.bus;\n    this.metrics = new PM2Metrics({ size: this.clusters.length });\n  }\n\n  listen() {\n    this.bus.on('process:msg', ({ raw : { client, metrics }, process }) => {\n      if (client) {\n        this.sender = new GraphiteSender({ ...client });\n      }\n      if (metrics) {\n        this.metrics.push(process.pm_id, metrics);\n        if (this.metrics.isFull()) {\n          this.sender.send(this.metrics.flatten())\n            .then(() => this.metrics.empty())\n            .catch(error => console.error(error.stack));\n        }\n      }\n    });\n    return this;\n  }\n}\n"]}